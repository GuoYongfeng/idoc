# 对前端集成解决方案的思考

## 吐槽

> 今天BOSS吐槽了一顿开发工具，顺带督促前端性能的优化工作推进，同时也在考虑开发工作的产品化问题，而且，移动端貌似也是领导比较在意的工作，毕竟这已经是个人人都在喊互联网+的时代。同时，回过头来看开发平台在做的一些事情，大家都忙忙碌碌的工作，产出了不少成果，光看代码量都知道这群码农是有多辛苦了。但是不抬头看路，永运只能像水牛一样，缓慢的干着体力活，确仍旧丝毫不敢懈怠的往前走，生怕主人在后面拿着皮鞭往身上抽。

收，下面切入正题吧。

## 前端需要解决什么问题

> 谈论这个问题，绝对是需要站在一个很高的抽象层面来思考。前端发展这么些年，零零散散的技术很多，首先让我们来看一个真正的前端团队要开发一个产品时所需要经历的过程：

### 第一阶段：规范与设计
  - 定制必要的开发规范
  - 定制项目的组件化拆分方案

### 第二阶段：技术选型
  - 选择前端组件化框架（seajs, requirejs, ...）
  - 选择前端基础库（jquery, tangram, ...）
  - 选择模板语言（php, smarty, ...）
  - 选择模板插件（xss修复）

### 第三阶段：自动化与拆分
  - 选择或开发自动化工具（打包，压缩，校验）
  - 将系统拆分为几个子系统，以便大团队并行开发
  - 适当调整框架以适应工具产出
  
### 第四阶段：性能优化
  - 小心剔除已下线的功能
  - 优化http请求
  - 适当调整自动化工具以适应性能优化
  - 使用架构级优化方案：BigPipe、BigRender等

以上是总结的前端团队的一个发展过程会面对到的所有问题。那么，再深入思考一下，基于发展过程可以用总结出一套完整的前端技术解决方案所包含的技术基础。
- **前端框架**：提供组件加载及管理框架支持，提供前端基础库及组件库。
- **模板框架**：提供组件化开发模式支持；配合前端框架收集页面所需要的最小静态资源需求；留有充分的性能优化空间，性能优化对工程师透明。
- **自动化工具**：提供基本优化能力；为前端框架、模板框架提供辅助支持。
- **辅助开发工具**：提升工程师的开发体验，降低调试、部署成本。

## 对方案的细化

### 开发规范

包括开发、部署的目录规范，编码规范等。不要小瞧规范的威力，可以极大的提升开发效率，真正优秀的规范不会让使用者感到约束，而是能帮助他们快速定位问题，提升效率。

### 模块化开发

针对js、css，以功能或业务为单元组织代码。js方面解决独立作用域、依赖管理、api暴露、按需加载与执行、安全合并等问题，css方面解决依赖管理、组件内部样式管理等问题。是提升前端开发效率的重要基础。现在流行的模块化框架有requirejs、seajs等。

### 组件化开发

在模块化基础上，以页面小部件(component)为单位将页面小部件的js、css、html代码片段放在一起进行开发、维护，组件单元是资源独立的，组件在系统内可复用。比如头部(header)、尾部(footer)、搜索框(searchbar)、导航(menu)、对话框(dialog)等，甚至一些复杂的组件比如编辑器(editor)等。通常业务会针对组件化的js部分进行必要的封装，解决一些常见的组件渲染、交互问题。

### 组件仓库

有了组件化，我们希望将一些非常通用的组件放到一个公共的地方供团队共享，方便新项目复用，这个时候我们就需要引入一个组件仓库的东西，现在流行的组件库有bower、component等。团队发展到一定规模后，组件库的需求会变得非常强烈。

### 性能优化

这里的性能优化是指能够通过工程手段保证的性能优化点。由于其内容比较丰富，就不在这里展开了，感兴趣的同学可以阅读我的这两篇文章 [1] [2]。性能优化是前端项目发展到一定阶段必须经历的过程。这部分我想强调的一点是 性能优化一定是一个工程问题和统计问题，不能用工程手段保证的性能优化是不靠谱的，优化时只考虑一个页面的首次加载，不考虑全局在宏观统计上的优化提升也是片面的。

### 项目部署

部署按照现行业界的分工标准，虽然不是前端的工作范畴，但它对性能优化有直接的影响，包括静态资源缓存、cdn、非覆盖式发布等问题。合理的静态资源资源部署可以为前端性能带来较大的优化空间。

### 开发流程

完整的开发流程包括本地开发调试、视觉效果走查确认、前后端联调、提测、上线等环节。对开发流程的改善可以大幅降低开发的时间成本，工作这些年见过很多独立的系统（CMS系统、静态资源推送系统）将开发流程割裂开，对前端开发的效率有严重的阻碍。

### 开发工具

这里说的工具不是指IDE，而是工程工具，包括构建与优化工具、开发-调试-部署等流程工具，以及组件库获取、提交等相关工具，甚至运营、文档、配置发布等平台工具。前端开发需要工具支持，这个问题的根本原因来自前端领域语言特性（未来我会单独写一篇文章介绍前端领域语言缺陷问题）。前端开发所使用的语言（js、css、html）以及前端工程资源的加载与定位策略决定了前端工程必须要工具支持。由于这些工具通常都是独立的系统，要想把它们串联起来，才有了yeoman这样的封装。前面提到的7项技术元素都直接或间接的对前端开发工具设计产生一定的影响，因此能否串联其他技术要素，使得前端开发形成一个连贯可持续优化的开发体系，工具的设计至关重要。

## 方案应该以什么样的方式提供

> 暂且先把这个标题再说一下，我主要想表达的意思是，加入准备出一个这样的方案来帮助前端开发人员解决这么一系列的问题，那么他们会觉得用图形化的IDE来操作合适，还是基于node封装一个包提供命令行的操作方式。

### 图形化

如果有一个ide或是工具，点击一个按钮就可以生成一个页面，点击一个按钮就可以部署代码，点击一个按钮就可以优化性能，点击一个按钮就可以管理版本，你会不会心动。如果这个方案集成在某个你喜欢的编辑器或是IDE上，你会不会心动。他们在这个方向：
- Hbuilder
- Eclipse
- Webstorm
- Intellig
- ...

### 命令行

Node已经火遍全球，我不是在吹牛，你去npm上看看全球每天有多少人下载nodejs你就知道了，看看npm上有多少开发者贡献的第三方包你就知道了。如果这个方案封装成一个node包，那么下载后你便可以在可以运行命令行的地方一行命令处理所有问题。他们在这样干：
- FIS（百度）
- JDF（京东）
- Gulp
- Grunt
- Turbo（美团）
- fekit（去哪儿）
- coolie
- webpack
- ...

> 个人观点：图形化来搞这个事情，貌似不太受欢迎。FIS在2013年出来之后，开发了一款“FIS可视化操作工具”，但是这个git仓库的代码两年前就没有人维护了，而且只有4个commits。这说明一个问题，开发者是还是觉得命令行来得灵活实在。诚然，这不是一个绝对的论点。

## 我们何去何从

### 其一
- 封装基于nodejs的工具包，来自动化处理前端事务

### 其二
- 对模板语言做一定扩展，具备加载widget及layout页面的能力